<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>The HTML5 Herald</title>
  <meta name="description" content="Local pokemon site">
  <meta name="author" content="SitePoint">

  <!--<link rel="stylesheet" href="css/styles.css?v=1.0">-->

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
  <!--Include these json files for no server version-->
  <script type="text/javascript" src="model/moves.json"></script>
  <script type="test/javascript" src="model/pokemon.json"></script>

  
  <script>
    $( document ).ready( function() {
      /*print out json files*/
      console.log(moves);
      //console.log(pokemon);

      /*bind selectable options to move type drop down list user control*/
      $("#moveTypeDropdownList").append(
        $("<option></option>").val('Any').html('Any')
      );
      $.each(moves, function (key, value) {
        $("#moveTypeDropdownList").append(
          $("<option></option>").val(key).html(key)
        );
      });

      /*bind events to form*/
      /*bind click action to randomize button*/
      $("#randomizeMovesButton").click(function() {
        var numberOfMoves = $("#numberMovesTextBox").val();
        var moveType = $("#moveTypeDropdownList").find("option:selected").text();
        var moveList = movePicker(numberOfMoves, moveType)

        console.log(moveList);
        displayMoves(moveList);
      });

      

    });

    function displayMoves(moveList)
    {
      $("#selectedMovesList").empty();
      for (var i = 0; i < moveList.length; i++)
      {
        var move = moveList[i];
        $("#selectedMovesList").append("<div id='move"+i+"'>");
        $.each(move, function(key, value) {
          $("#move"+i).append("<p><b>"+ key.toUpperCase() + "</b> : " + value +"</p>");  
        }); 
        $("#selectedMovesList").append("<br/>");
      }
    }

    function movePicker(desiredMoves, moveType)
    {
      var pickedMoves = [];
      
      /*if ( desiredMoves > totalMoveCount)
      {
        console.log("You asked for more moves than are available in the file!"); //Need to correctly handle error
        return pickedMoves;
      }*/
      for ( var i = 0; i < desiredMoves;)
      {
        if (moveType == "Any")
        {
          var position = Math.floor(Math.random()*Object.keys(moves).length);
          moveType = Object.keys(moves)[position];
        }
        var moveSet = eval("moves." + moveType);

        var position = Math.floor(Math.random()*Object.keys(moveSet).length);
        var selectedMoveName = Object.keys(moveSet)[position];
        var selectedMove = moveSet[selectedMoveName];
        
        if ( moveNotPicked(pickedMoves, selectedMoveName) )       
        {
          pickedMoves.push(selectedMove);
          i++;
        }       
      }
      return pickedMoves;
    }

    function moveNotPicked(pickedMoves, selectedMoveName)
    {
      for ( var i = 0; i < pickedMoves.length; i++) //for each loop doesn't work?
      {
        if ( selectedMoveName == pickedMoves[i].name ) { return false; }
      }
      return true;
    }


  </script>

  <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
  <![endif]-->
</head>

<body>
  <header id="header">
    <h1>Pokemon RPG</h1>
  </header>
  
  <section id="randomGenerator">
    <div id="randomGeneratorDescription">
      <h3>Move Selector</h3>
      <p>These controls allow you to randomly load in moves from the local moves.json file.</p>
    <div>

    <form id="randomGeneratorForm">
      <label for="numberMoves">Number of Moves: </label>
      <input type="number" name="numberMoves" id="numberMovesTextBox" min="1" max="10" value="1"/> <br/>
      <label for="moveType">Move Type: </label>
      <select name="moveType" id="moveTypeDropdownList"></select><br/>
      <input type="button" id="randomizeMovesButton" value="Randomize" /> 
    </form>
  </section>

  <section id="selectedMoveSection">
    <div id="selectedMoveSelectionDescription">
      <h3>Selected Moves</h3>
    </div>
    <div id="selectedMovesList">
    </div>
  </section>

</body>
</html>